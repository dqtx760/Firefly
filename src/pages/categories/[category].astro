---
import { getCollection } from "astro:content";
import { getSortedPosts } from "@utils/content-utils";
import MainGridLayout from "@layouts/MainGridLayout.astro";

export async function getStaticPaths() {
    const posts = await getCollection("posts", ({ data }) => {
        return import.meta.env.PROD ? data.draft !== true : true;
    });

    // è·å–æ‰€æœ‰å”¯ä¸€çš„åˆ†ç±»
    const categories = [...new Set(posts.map(post => post.data.category || "æœªåˆ†ç±»"))];

    // è‹±æ–‡åç§°æ˜ å°„
    const categoryEnglishName = new Map<string, string>();
    categoryEnglishName.set("è½¯ä»¶å®‰åˆ©", "Software");
    categoryEnglishName.set("æŠ€æœ¯æ•™ç¨‹", "Technical");
    categoryEnglishName.set("AIæ–°é²œç©æ³•", "AIHacks");

    return categories.map(category => ({
        params: { category: categoryEnglishName.get(category) || category },
        props: { chineseName: category }
    }));
}

const { category: englishCategory } = Astro.params;
const { chineseName } = Astro.props;

// è·å–å½“å‰åˆ†ç±»çš„æ–‡ç« 
const allPosts = await getSortedPosts();
const categoryPosts = allPosts.filter(post => (post.data.category || "æœªåˆ†ç±»") === chineseName);

const config = {
    title: `${englishCategory} - æ–‡ç« åˆ†ç±»`,
    description: `æŸ¥çœ‹æ‰€æœ‰ ${chineseName}(${englishCategory}) åˆ†ç±»ä¸‹çš„æ–‡ç« `
};
---

<MainGridLayout title={config.title} description={config.description}>
    <div class="card-base p-6 rounded-xl">
        <div class="mb-6">
            <h1 class="text-2xl font-bold text-neutral-800 dark:text-neutral-200 mb-2">
                ğŸ“ {englishCategory}
            </h1>
            <p class="text-neutral-600 dark:text-neutral-400">å…± {categoryPosts.length} ç¯‡æ–‡ç« </p>
        </div>

        {categoryPosts.length > 0 ? (
            <div class="flex flex-col gap-4">
                {categoryPosts.map((post) => (
                    <a href={`/posts/${post.slug}/`} class="block group">
                        <div class="p-4 rounded-lg border border-neutral-200 dark:border-neutral-800 hover:border-[var(--primary)] transition-all hover:bg-neutral-50 dark:hover:bg-neutral-900/50">
                            <h2 class="text-lg font-bold text-neutral-800 dark:text-neutral-200 group-hover:text-[var(--primary)] transition-colors">
                                {post.data.title}
                            </h2>
                        </div>
                    </a>
                ))}
            </div>
        ) : (
            <div class="text-center py-12 text-neutral-500 dark:text-neutral-400">
                <p>æš‚æ— è¯¥åˆ†ç±»çš„æ–‡ç« </p>
            </div>
        )}
    </div>
</MainGridLayout>
